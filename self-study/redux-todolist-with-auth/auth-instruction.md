# Инструкция: как сделать логин на редаксе

1. Посмотри на фичу `features/auth`. Начнём со стэйта `types/AuthState.ts`. Поле `authChecked` разберём позже. Поле `user` может быть `undefined` (это значит, что пользователь незалогинен) либо может содержать залогиненого пользователя.
2. Пристуми к форме логина. Посмотри на React-компонент `LoginPage.tsx`. Прочитай код с комментариями.
3. Как видишь при сабмите делается запрос на сервер, а затем кидается диспатч, чтобы положить залогиненого пользователя в стэйт (посмотри в `reducer.ts`, кейс для экшена - `auth/loginSuccess`)
4. Юзер появился в централизованном стэйте в поле `state.auth.user`. Посмотри в компонент `features/main/NavBar.tsx` на строку `const user = useSelector(selectUser)`. Здесь с помощью селектора `selectUser` (который как раз возвращает нам поле `state.auth.user`) мы берём залогиненного пользователя из стэйта. Если `user` в итоге `undefined` значит отображаем navbar для незалогиненого пользователя, иначе для залогиненного.
5. Обрати внимание, после того как мы перезагрузим страницу в поле `state.auth.user` централизованного стэйта опять будет лежать `undefined` так как это указанно в начальном состоянии (`initialState`) в файле `features/auth/reducer.ts`. Надо бы сделать так, чтобы после перезагрузки страницы залогиненный пользователь опять попадал в это поле стэйта.
6. Для этого во время загрузки приложения кинем запрос на сервер, чтобы узнать залогинен пользователь или нет. Смотри файл `App/App.tsx` строку с `api.checkUser()`.
7. Обрати внимание на флаг `authChecked` в `features/auth/types/AuthState.ts`. Когда приложение только загружается он равен `false`. Это значит, что мы ещё не знаем залогинен пользователь или нет. Посмотри в файл `App/App.tsx` начиная со стоки `if (!authChecked) {`. То есть если мы ещё не проверили статус пользователя мы вообще не рендерим приложение, а рендерим лоадер.
8. После того как мы получили ответ с сервера (то что мы делали в 6-м пункте) userChecked кидаем `dispatch(userChecked(...))`, смотри соответствующий `actionCreator` и `reducer`, там есть комментарии.
9. Посмотри в файл `features/main/NavBar.tsx` на кнопку `выход`. Как она работает изучи самостоятельно.`
